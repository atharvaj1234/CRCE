
1. Introduction to Security Accounts Manager (SAM) Database
The Security Accounts Manager (SAM) database is a vital component of Microsoft Windows operating systems, responsible for storing passwords locally on the computer system and maintaining user and account information for authentication to the local system when an account has been created for a user. 1 The SAM database stores passwords in either LAN Manager (LM) hash or NT LAN Manager (NTLM) format, depending on the policies implemented and enforced for password storage. During normal operation, the SAM database cannot be copied due to restrictions enforced by the operating system kernel, and it is stored in two locations within Windows: %systemroot%\system32\config\sam for the main storage and %systemroot%\repair\sam._ as a backup for recovery purposes. The SAM database plays a significant role in authentication and access control within Windows, providing system users the ability to authenticate to the local system.

2. Architecture and Storage of the SAM Database
The SAM database is responsible for storing user and account information locally on Windows computer systems, enabling system users to authenticate to the local system if an account has been created for them. 1 Passwords stored in the SAM database are saved in either LM hash or NTLM format, depending on the password storage policies enforced by the system administrator. The SAM database is located at %systemroot%\system32\config\sam, which serves as the main storage for passwords, and a backup copy is maintained at %systemroot%\repair\sam._ for recovery purposes. During normal operation, the SAM database is protected by operating system kernel restrictions, preventing it from being copied.

The process of creating an LM hash involves converting the entire password to uppercase before hashing. For example, the password “mypass” is converted to “MYPASS” during LM hash creation. LM hashes are only generated and stored for passwords less than 15 characters in length; if a password exceeds this length, only an NTLM hash is stored. LM hashes are considered cryptographically weak because they are susceptible to brute force attacks. In recent versions of Windows, LM hash storage is disabled by default, and administrators must enable it explicitly if required. 1

To provide additional encryption for password information stored in the SAM database, the System Key (SYSKEY) was introduced as an optional feature in Windows NT 4.0 and is enabled by default in Windows 2000 and later versions. SYSKEY encrypts the data in the SAM database with a 128-bit encryption key while the operating system is not running. During the boot process, SYSKEY is loaded into active memory to allow access to SAM passwords and other secrets. If SYSKEY is corrupt or missing, the operating system cannot decrypt the SAM database, preventing user logon. Several different options exist for implementing and refining how SYSKEY is used in your environment. 1

3. SAM Database in Authentication and Access Control
The SAM database is used to store user and account information locally on Windows workstations and servers, enabling system users to authenticate to the local system if an account has been created for them. 1 During interactive logon, when a user presents credentials for a local computer account, these credentials are verified against the SAM database on the local machine. 2 Every Windows NT, 2000, and Server 2003 workstation, stand-alone server, or member server maintains a SAM database for this purpose. Accounts stored in the SAM database are only valid for access to the specific computer where they reside.

Passwords in the SAM database are stored in either LM hash or NTLM format, depending on the password storage policies enforced. 1 The SAM database cannot be copied during normal operation due to operating system kernel restrictions. The main storage location for the SAM database is %systemroot%\system32\config\sam, with a backup at %systemroot%\repair\sam._.

When a domain account is used for logon, authentication is performed against the Active Directory database, allowing access to both the local workstation and other resources in the domain and any trusting domains. 2 In this scenario, the domain account works in conjunction with the workstation’s SAM database, and access to the local computer is granted if the domain account has the appropriate permissions and rights locally. Windows Server 2003 provides several mechanisms for network authentication, including Kerberos and NTLM.

4. Security Vulnerabilities and Attack Techniques Targeting SAM
Accounts data stored in the local machine's SAM database is protected by a file locking mechanism while the operating system is running, but attackers can bypass this by booting from external media, such as a bootable floppy, to copy the SAM database from its default location and use various tools to attack it. If an attacker gains physical access, they can delete the SAM database, resulting in the administrator account being re-created with a blank password upon reboot, and all other accounts being removed. Backup media containing the SAM database is also vulnerable if not protected from theft or unauthorized use, as backup operations typically include this database information. Tools exist for breaching NTFS drives and retrieving data from them, highlighting the necessity of basic physical security to protect against these vulnerabilities. 3

Password hash extraction from the SAM database is commonly performed using techniques such as Dynamic Link Library (DLL) injection and tools like pwdump, which can dump hashes directly from memory by injecting a DLL into critical processes such as Local Security Authority Subsystem Service (LSASS). Attackers with administrative access can query the SAM database and extract credentials, including username, hash type (LM or NTLM), LM hash, NT hash, and password. Public tools facilitating hash dumping and password extraction include pwdump and fgdump, with effectiveness depending on Windows version and technique used. Administrative access is required for hash extraction, and privilege escalation is critical for extracting credentials from different components. 4 5

Metasploit modules such as PowerDump can be used to dump the SAM database on Microsoft operating systems. However, security measures in the Registry on recent Microsoft OS versions restrict access to keys like HKLM:\SAM\SAMDomains\Accounts\Users, requiring more than administrative access. These modules may work on older systems such as Windows XP or Server 2003, depending on patch level. Modifying Registry permissions to enable access involves significant system changes. 6

Pass-the-hash attacks exploit the ability to reuse stolen password hashes to compromise additional systems, including domain controllers and servers, without cracking the hashes. Attackers require password hashes and authentication tokens, network logon rights, and direct access to other systems running listening services. These attacks are particularly effective in networks configured with Active Directory, potentially granting access to administrative accounts across domains or enterprises. Administrative rights are necessary to dump hashes for pass-the-hash attacks. 4

Vulnerabilities in the SAM database arise from weak password storage mechanisms, such as the use of LM hashes, which are susceptible to attack. 3 5 The exposure of backup media further increases risk, as attackers can retrieve SAM database information from unprotected backups.

5. Protection Mechanisms and Hardening Strategies for SAM Database
The SAM database is protected during normal operation by a file locking mechanism, which prevents copying of the database while the operating system is running. 3 1 The operating system kernel enforces restrictions that make the SAM database inaccessible for copying under standard conditions. The main storage location for the database is %systemroot%\system32\config\sam, with a backup at %systemroot%\repair\sam._ for recovery purposes.

The system key (SYSKEY) was first implemented in the Windows NT 4.0 platform as an optional feature and is enabled by default while starting the Windows 2000 operating system. 1 This utility provides additional encryption for password information that is stored in the SAM and Active Directory databases. 2 Offline attacks against the SAM database are possible because its contents are also stored in memory, and tools such as Metasploit, fgdump, and Cain & Abel can be used to obtain stored password hashes.

Best practices for password policy enforcement include creating strong password requirements, implementing account lockout policies, and educating users about the risks of weak passwords and credential reuse. 2 Passwords stored in the SAM database use either LM hash or NTLM format, depending on enforced policies. 1 A weak password is defined as one containing any portion of a user's name, company name, network logon ID, or any complete dictionary word. Rainbow tables are used to recover plaintext passwords from hash outputs stored in the SAM database, making strong password policies essential to mitigate this risk. 7

Physical security is critical, as unrestricted access to the machine allows attackers to copy or delete the SAM database, and backup media containing the database must be protected from theft or unauthorized use. 3

6. Advances and Alternatives in Account Security Management
The SAM database remains a foundational component for local account security in Windows, but modern environments increasingly integrate with Active Directory to centralize identity and access management. Windows Server 2012 includes the Active Directory Domain Services feature, which provides a distributed database for managing network resources and application-specific data for directory-enabled applications. New features such as virtualized domain controller cloning allow administrators to create additional domain controllers efficiently, supporting disaster recovery by enabling forest infrastructure recreation from a single running virtualized domain controller. Virtualized domain controllers are now fully supported and safe, addressing previous concerns about inconsistent passwords and lingering objects in the Active Directory database, as well as duplicate security identifiers (SIDs) when restoring from snapshots. 8

Federated identity management is an effective foundation for identity in cloud computing, allowing for interoperability with customer and third-party identity providers or realms as may be appropriate. 9 Federated identity management permits extending single sign-on (SSO) above the enterprise level, creating a trusted authority for digital identities across multiple organizations. In a federated system, participating institutions share identity attributes based on agreed-upon standards, facilitating authentication from other members of the federation and granting appropriate access to online resources. This approach streamlines access to digital assets while protecting restricted resources. 10 11 12

Identity as a Service (IDaaS), or cloud identity, allows organizations to leverage cloud services for identity management. Many of the IDaaS vendors can directly integrate with cloud-hosted applications and other public facing third-party applications to allow for more streamlined identity management and single-sign on. Other commonly realized security benefits from integration with cloud identity providers include: easier deployment and integration of two-factor or multifactor authentication, self-service account management and password resets, better support for integrating mobile devices, and centralized audit capabilities. With cloud identity, if the identity provider suffers a breach, then client organizations could well be devastated as a result. 11 12

Federated identity management helps reduce the number of credential sets that users need to memorize, as users can authenticate once and access resources across trusted domains. 13 This can help increase the overall security of users’ applications.

Trusted Execution Environments (TEEs) use hardware-based techniques to isolate data and code, ensuring confidentiality and integrity even from privileged resources. Intel Software Guard Extensions (SGX) is a TEE that allows the creation of protected enclaves within the CPU, providing a secure region for code and data that is isolated from other processes, including the operating system and hypervisor. SGX enclaves guarantee confidentiality and integrity, and the trust boundary is reduced to the CPU package. 14 15

7. Conclusion
The Security Accounts Manager database is a critical component of Microsoft Windows operating systems, providing local storage of user account information and password hashes essential for authentication and access control. Its architecture, including storage locations and encryption mechanisms such as the System Key, ensures a baseline of security, though vulnerabilities remain, particularly when physical access is compromised or weak password policies are enforced. Attack techniques like password hash extraction and pass-the-hash attacks exploit these vulnerabilities, underscoring the importance of robust protection mechanisms including strong password policies, physical security, and encryption.

Advances in account security management, including integration with Active Directory, federated identity management, and cloud-based Identity as a Service, offer enhanced security and streamlined access control across enterprise and cloud environments. Additionally, hardware-based Trusted Execution Environments such as Intel Software Guard Extensions provide promising avenues for securing sensitive data and code against sophisticated attacks.

Overall, securing the SAM database requires a comprehensive approach combining technical safeguards, policy enforcement, and physical security measures to mitigate risks and protect user credentials effectively.